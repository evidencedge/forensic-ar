<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forensic AR — Full Poster Overlay</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <!-- MindAR for A-Frame (image tracking) -->
  <script src="https://unpkg.com/mind-ar@1.1.4/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; }
    #loading { position:absolute; top:10px; left:10px; color:white; font-family:Arial, sans-serif; z-index:2; }
    #hint { position:absolute; bottom:10px; left:10px; color:rgba(255,255,255,0.9); font-family:Arial, sans-serif; font-size:14px; z-index:2; }
    /* ensure video texture updates smoothly on mobiles */
    video { -webkit-playsinline: true; playsinline: true; }
  </style>
</head>
<body>
  <div id="loading">Point your camera to the poster — loading AR...</div>
  <div id="hint">Allow camera permission & hold steady. Tap once to unmute after play.</div>

  <a-scene
    mindar-image="imageTargetSrc: target.mind; maxTrack: 1;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    embedded
    renderer="alpha: true; antialias: true;"
  >
    <a-assets>
      <img id="poster" src="poster.jpg" crossorigin="anonymous" />
      <!-- video should be muted to allow autoplay; user can tap to unmute -->
      <video id="arvideo" src="video.mp4" crossorigin="anonymous" playsinline webkit-playsinline loop muted></video>
    </a-assets>

    <a-entity camera></a-entity>

    <!-- 
        Poster plane: width = 1, height = poster_ratio (A3 ratio ~1.414)
        This maps plane to the poster target. Video maps to plane. 
        If your poster physical size differs, the target generator will map accordingly.
    -->
    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane id="videoPlane"
               position="0 0 0"
               rotation="-90 0 0"
               width="1"
               height="1.414"
               material="shader: flat; src: #arvideo;"
               visible="false">
      </a-plane>
    </a-entity>
  </a-scene>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sceneEl = document.querySelector("a-scene");
      const video = document.querySelector("#arvideo");
      const plane = document.querySelector("#videoPlane");
      const loading = document.getElementById("loading");

      const hideLoading = () => setTimeout(()=>{ loading.style.display = "none"; }, 800);
      sceneEl.addEventListener("renderstart", hideLoading);

      // When target found -> show plane and play video
      sceneEl.addEventListener("targetFound", () => {
        plane.setAttribute("visible", "true");
        video.muted = true; // must stay muted for autoplay on most browsers
        const p = video.play();
        if (p !== undefined) {
          p.catch(e => {
            console.warn("Autoplay blocked. User interaction may be required to start video.");
          });
        }
      });

      // When target lost -> pause/hide
      sceneEl.addEventListener("targetLost", () => {
        try { video.pause(); video.currentTime = 0; } catch(e){}
        plane.setAttribute("visible", "false");
      });

      // Tap to unmute (optional friendly UX)
      document.body.addEventListener("click", () => {
        if (video && video.muted) { video.muted = false; }
      });
    });
  </script>
</body>
</html>

